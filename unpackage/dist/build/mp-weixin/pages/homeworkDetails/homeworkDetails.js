"use strict";var e=require("../../common/vendor.js");const o={data:()=>({homeworkInfo:{},canNotRadio:!0,ifCheckRadio:!1,authorInfo:{}}),async onLoad(o){const t=o.id,a=e.pn.database(),{result:i}=await a.collection("homework").where({_id:t}).get();this.homeworkInfo=i.data[0];const n=e.index.getStorageSync("userAccount");if(n){this.canNotRadio=!1;const o=e.pn.database(),{result:t}=await o.collection("homework").where({_id:this.homeworkInfo._id}).get(),a=t.data[0].completeUsers;a.indexOf(n),-1!==a.indexOf(n)?this.ifCheckRadio=!0:this.ifCheckRadio=!1}const s=(await a.collection("users").where({account:this.homeworkInfo.author}).get()).result.data[0];this.authorInfo=s},methods:{preview(o){e.index.previewImage({urls:[o]})},async changeRandio(o){if("1"===o.detail.value){const o=e.index.getStorageSync("userAccount"),t=e.pn.database(),{result:a}=await t.collection("homework").where({_id:this.homeworkInfo._id}).get(),i=a.data[0].completeUsers;-1===i.indexOf(o)?(i.push(o),await t.collection("homework").where({_id:this.homeworkInfo._id}).update({completeUsers:i}),e.index.showToast({title:"修改成功",duration:2e3})):e.index.showToast({title:"已经在完成列表中",duration:2e3})}else{const o=e.index.getStorageSync("userAccount"),t=e.pn.database(),{result:a}=await t.collection("homework").where({_id:this.homeworkInfo._id}).get(),i=a.data[0].completeUsers,n=i.indexOf(o);i.splice(n,1),await t.collection("homework").where({_id:this.homeworkInfo._id}).update({completeUsers:i}),e.index.showToast({title:"修改成功",duration:2e3})}},delThis(){const o=this.homeworkInfo;e.index.showModal({title:"删除",content:"确定要删除吗",success(t){!0===t.confirm&&e.index.showModal({title:"再次确认",content:"确定要删除此作业吗",async success(t){if(!0===t.confirm){console.log(o);const t=e.pn.importObject("delClassImg");o.images.map((async e=>{await t.delImg(e)}));const a=e.pn.database();await a.collection("homework").where({_id:o._id}).remove(),e.index.showModal({title:"完成",content:"删除完成",showCancel:!1,success(){e.index.navigateBack({delta:1})}})}}})}})}}};var t=e._export_sfc(o,[["render",function(o,t,a,i,n,s){return{a:e.t(n.homeworkInfo.title),b:e.t(n.homeworkInfo.deadLine),c:!n.ifCheckRadio,d:n.canNotRadio,e:n.ifCheckRadio,f:n.canNotRadio,g:e.o(((...e)=>s.changeRandio&&s.changeRandio(...e))),h:e.t(n.homeworkInfo.content),i:e.f(n.homeworkInfo.images,((o,t,a)=>({a:o,b:o,c:e.o((e=>s.preview(o)),o)}))),j:n.authorInfo.headImg,k:e.t(n.authorInfo.nickName),l:e.t(n.homeworkInfo.time),m:e.o(((...e)=>s.delThis&&s.delThis(...e))),n:n.canNotRadio}}]]);wx.createPage(t);
